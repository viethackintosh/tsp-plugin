import{fchRequest as e,createFormItem as t,masterNotice as o,masterModal as n}from"./index.min.js";import{URI_UPLOAD as a}from"./helpers/const.min.js";import{DragDrop as l}from"./index.min.js";let DDocument=function(){let r=this;r.fileContent,r.reader,r.form,r.init=()=>(Array.from(document.querySelectorAll(".order--document")).map(e=>{let t=JSON.parse(e.getAttribute("data"));e.removeAttribute("data"),Object.assign(e,{owner:t});let o=e.querySelector(".delete__button");o&&Object.assign(o,{onclick:e=>r.removeDocument({event:e})});let n=e.querySelector(".preview--document");n&&(n.onclick=e=>r.previewDocument({event:e}));let a=e.querySelector(".upload--document");a&&(a.onclick=e=>r.uploadDocument({event:e}))}),r.reader=new FileReader,r.reader.addEventListener("load",e=>{r.fileContent=e.target.result}),r.form=r.dragAndDropUploadForm(),r),r.removeButton=()=>t({tag:"span",className:"dashicons dashicons-trash delete__button",onclick:e=>r.removeDocument({event:e})}),r.removeDocument=async({event:t})=>{t.preventDefault();let n=t.target.closest("a"),a=n.owner;a.file="";let l=n.querySelector(".preview--document");l.innerHTML=a.title,l.classList.remove("preview--document"),l.classList.add("upload--document"),l.onclick=e=>r.uploadDocument({event:e}),n.querySelector(".delete__button").remove();try{let i=await e({ftchURI:"/wp-json/tinsinhphuc/document/remove",data:{method:"POST",body:JSON.stringify({owner:a})}});o.open({message:i.message,icon:!0,style:"info",timer:1500})}catch{}},r.previewDocument=({event:e})=>{e.preventDefault();let t=e.target.closest("a").owner;PDFObject.embed(`${a}${t.file}`,"#modalmaster .modal__body",{height:"830px",width:"830px"}),n.open({options:{clear:!0,title:`Bạn đang xem ${t.file}`,header:!0,footer:!1}})},r.uploadDocument=({event:e})=>{e.preventDefault();let t=e.target.closest("a"),o=n.modal.querySelector(".body .upload__wrapper"),a=n.modal.querySelector(".footer .upload__toserver");o||n.modal.querySelector(".body").append(r.form.form),a?a.target=t:n.modal.querySelector(".footer").append(r.uploadButtonFiles({target:t})),n.open({options:{title:`Bạn ${t.owner.title} cho #${t.owner.ID}`,footer:!0}})},r.dragAndDropUploadForm=()=>{let e=new l().init({id:"uploader",config:{message:"K\xe9o thả file v\xe0o đ\xe2y để tải l\xean",label:"Ấn v\xe0o đ\xe2y để chọn file",multiple:!0,accept:"application/pdf"}});return e},r.uploadDocumentForm=()=>{let e=t({tag:"p",className:"upload__message"}),o=t({tag:"span",innerHTML:"file name here",className:"upload__filename"}),n=t({tag:"input",type:"file",accept:".pdf",id:"filetoupload",style:"display:none",onchange:e=>r.choiceFileChange({event:e})});return{form:t({tag:"div",className:"upload__wrapper",children:[e,t({tag:"p",className:"upload__item",children:[o,]}),t({tag:"label",className:"upload__choicefile button --primary",innerHTML:"Chọn file",children:[n,]}),]}),message:e,uploadFileName:o,inputFile:n}},r.choiceFileChange=({event:e})=>{let t=e.target.files[0],o=e.target.files[0].name,n=document.querySelector(".upload__filename");n&&(n.innerHTML=o),r.reader.readAsDataURL(t)},r.uploadButtonFiles=({target:e})=>t({tag:"p",className:"upload__server",children:[{tag:"span",innerHTML:"Tải l\xean server",className:"upload__toserver button --primary",target:e,onclick:e=>r.uploadFileToServer({event:e})}]}),r.uploadFileToServer=async({event:t})=>{let a=r.form.inputFile.files[0],l=t.target.target;if(a){let i={name:a.name,type:a.type,fileContent:r.fileContent};try{let c=await e({ftchURI:"/wp-json/tinsinhphuc/document/upload",data:{method:"POST",body:JSON.stringify({owner:l.owner,file:i})}});if(c.result){l.owner.file=a.name;let m=l.querySelector(".upload--document");m.innerHTML=a.name,m.classList.remove("upload--document"),m.classList.add("preview--document"),m.onclick=e=>r.previewDocument({event:e}),l.append(r.removeButton()),r.form.inputFile.value=null,r.form.uploadFileName.innerHTML="File name here",r.form.message.innerHTML="",n.close({clear:!1}),o.open({message:c.message,icon:!0,style:"info",timer:1500})}else r.form.message.innerHTML=c.message}catch{}}else r.form.message.innerHTML="Chọn file đi \xd4ng thần ve chai!!!!"}},dDocument=new DDocument().init();