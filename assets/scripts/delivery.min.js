import{Master as e,createFormItem as t,Accordion as n,masterNotice as a,masterModal as i}from"./index.min.js";import{DELIVERY_TEMPLATE_API as r}from"./helpers/const.min.js";let Delivery=function(){let n=new e;return n.storageName="phieugiaohang",n.init,n.title="Phiếu giao h\xe0ng",n.updateDelivery=async({event:e})=>{let t=e.target.ownData;try{let r=await n.getOrder({orderId:t.ID});(r.products.map(e=>e.orderId=t.ID),n.data.user)?n.data.user.nickname==r.user.nickname?n.data.products.find(e=>e.orderId==t.ID)?i.open({options:{title:"Cảnh b\xe1o",clear:!0,content:n.existOrderInDelivery({order:r,ID:t.ID})}}):(n.data.products=[...n.data.products,...r.products],a.open({message:`Đ\xe3 th\xeam đơn h\xe0ng #${t.ID} v\xe0o phiếu giao h\xe0ng`,icon:!0,style:"info",timer:1500})):i.open({options:{title:"Cảnh b\xe1o",clear:!0,content:n.notSameCustomer({order:r,ID:t.ID})}}):(n.data={...n.data,user:r.user,products:r.products},a.open({message:`Đ\xe3 th\xeam đơn h\xe0ng #${t.ID} v\xe0o phiếu giao h\xe0ng`,icon:!0,style:"info",timer:1500}))}catch{}finally{localStorage.setItem(n.storageName,JSON.stringify(n.data))}},n.notSameCustomer=({order:e,ID:a})=>t({tag:"p",className:"Message",innerHTML:"Kh\xe1ch h\xe0ng thuộc đơn h\xe0ng bạn muốn th\xeam v\xe0o kh\xf4ng tr\xf9ng với kh\xe1ch h\xe0ng hiện tại. Bạn muốn &nbsp;",children:[{tag:"a",href:"#",innerHTML:"thay đổi",onclick:t=>n.changeAllDelivery({event:t,order:e,ID:a})}]}),n.existOrderInDelivery=({order:e,ID:a})=>t({tag:"p",className:"Message",innerHTML:"Đ\xe3 tồn đơn h\xe0ng n\xe0y trong phiếu giao h\xe0ng. Bạn muốn &nbsp;",children:[{tag:"a",href:"#",innerHTML:"Cập nhật lại",onclick:t=>n.updateAgainOrder({event:t,order:e,ID:a})}]}),n.changeAllDelivery=({event:e,order:t,ID:r})=>{n.data.user=t.user,n.data.products=t.products,localStorage.setItem(n.storageName,JSON.stringify(n.data)),i.close({clear:!0}),a.open({message:`Đ\xe3 cập nhật lại phiếu giao h\xe0ng với kh\xe1ch h\xe0ng & đơn h\xe0ng mới`,icon:!0,style:"info",timer:1500})},n.updateAgainOrder=({event:e,order:t,ID:r})=>{let o=n.data.products.filter(e=>e.orderId!=r);n.data.products=[...o,...t.products],localStorage.setItem(n.storageName,JSON.stringify(n.data)),i.close({clear:!0}),a.open({message:`Đ\xe3 cập nhật lại đơn h\xe0ng #${r} v\xe0o phiếu giao h\xe0ng`,icon:!0,style:"info",timer:1500})},n.createAttribute=()=>[],n.updateTotal=()=>{},n.otherPage=()=>{document.querySelectorAll(".updateDelivery").forEach(e=>{let t=JSON.parse(e.getAttribute("data"));Object.assign(e,{ownData:t,onclick:e=>n.updateDelivery({event:e})})})},n},delivery=new Delivery().init({id:"delivery",templateName:"delivery",restAPI:r});window.onload=function(){new n().init({id:"accordion",onlyAccordionOpen:!0})};