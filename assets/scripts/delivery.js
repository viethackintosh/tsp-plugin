import{Master as e,masterNotice as t,masterModal as n}from"./master.js";import{createFormItem as r}from"./helpers/formgroup.js";import{Accordion as a}from"./uxui/Accordion.js";import{DELIVERY_TEMPLATE_API as i}from"./helpers/const.js";let Delivery=function(){let a=new e;return a.storageName="phieugiaohang",a.init,a.title="Phiếu giao h\xe0ng",a.updateDelivery=async({event:e})=>{let r=e.target.ownData;try{let i=await a.getOrder({orderId:r.ID});(i.products.map(e=>e.orderId=r.ID),a.data.user)?a.data.user.nickname==i.user.nickname?a.data.products.find(e=>e.orderId==r.ID)?n.open({options:{title:"Cảnh b\xe1o",clear:!0,content:a.existOrderInDelivery({order:i,ID:r.ID})}}):(a.data.products=[...a.data.products,...i.products],t.open({message:`Đ\xe3 th\xeam đơn h\xe0ng #${r.ID} v\xe0o phiếu giao h\xe0ng`,icon:!0,style:"info",timer:1500})):n.open({options:{title:"Cảnh b\xe1o",clear:!0,content:a.notSameCustomer({order:i,ID:r.ID})}}):(a.data={...a.data,user:i.user,products:i.products},t.open({message:`Đ\xe3 th\xeam đơn h\xe0ng #${r.ID} v\xe0o phiếu giao h\xe0ng`,icon:!0,style:"info",timer:1500}))}catch{}finally{localStorage.setItem(a.storageName,JSON.stringify(a.data))}},a.notSameCustomer=({order:e,ID:t})=>r({tag:"p",className:"Message",innerHTML:"Kh\xe1ch h\xe0ng thuộc đơn h\xe0ng bạn muốn th\xeam v\xe0o kh\xf4ng tr\xf9ng với kh\xe1ch h\xe0ng hiện tại. Bạn muốn &nbsp;",children:[{tag:"a",href:"#",innerHTML:"thay đổi",onclick:n=>a.changeAllDelivery({event:n,order:e,ID:t})}]}),a.existOrderInDelivery=({order:e,ID:t})=>r({tag:"p",className:"Message",innerHTML:"Đ\xe3 tồn đơn h\xe0ng n\xe0y trong phiếu giao h\xe0ng. Bạn muốn &nbsp;",children:[{tag:"a",href:"#",innerHTML:"Cập nhật lại",onclick:n=>a.updateAgainOrder({event:n,order:e,ID:t})}]}),a.changeAllDelivery=({event:e,order:r,ID:i})=>{a.data.user=r.user,a.data.products=r.products,localStorage.setItem(a.storageName,JSON.stringify(a.data)),n.close({clear:!0}),t.open({message:`Đ\xe3 cập nhật lại phiếu giao h\xe0ng với kh\xe1ch h\xe0ng & đơn h\xe0ng mới`,icon:!0,style:"info",timer:1500})},a.updateAgainOrder=({event:e,order:r,ID:i})=>{let o=a.data.products.filter(e=>e.orderId!=i);a.data.products=[...o,...r.products],localStorage.setItem(a.storageName,JSON.stringify(a.data)),n.close({clear:!0}),t.open({message:`Đ\xe3 cập nhật lại đơn h\xe0ng #${i} v\xe0o phiếu giao h\xe0ng`,icon:!0,style:"info",timer:1500})},a.createAttribute=()=>[],a.updateTotal=()=>{},a.otherPage=()=>{document.querySelectorAll(".updateDelivery").forEach(e=>{let t=JSON.parse(e.getAttribute("data"));Object.assign(e,{ownData:t,onclick:e=>a.updateDelivery({event:e})})})},a},delivery=new Delivery().init({id:"delivery",templateName:"delivery",restAPI:i});window.onload=function(){new a().init({id:"accordion",onlyAccordionOpen:!0})};