import{fchRequest as e}from"./helpers/fetch.js";import{createFormItem as t}from"./helpers/formgroup.js";import{masterModal as o,masterNotice as r}from"./master.js";import{URI_UPLOAD as n}from"./helpers/const.js";import{DragDrop as l}from"./uxui/Dragdrop.js";let DDocument=function(){let a=this;a.form,a.init=()=>(Array.from(document.querySelectorAll(".order--document")).map(e=>{let t=JSON.parse(e.getAttribute("data"));e.removeAttribute("data"),Object.assign(e,{owner:t});let o=e.querySelector(".delete__button");o&&Object.assign(o,{onclick:e=>a.removeDocument({event:e})});let r=e.querySelector(".preview--document");r&&(r.onclick=e=>a.previewDocument({event:e}));let n=e.querySelector(".upload--document");n&&(n.onclick=e=>a.uploadDocument({event:e}))}),a.form=a.dragAndDropUploadForm(),a),a.removeButton=()=>t({tag:"span",className:"dashicons dashicons-no-alt delete__button",onclick:e=>a.removeDocument({event:e})}),a.removeDocument=async({event:t})=>{t.preventDefault();let o=t.target.closest("a"),n=o.owner;n.file="";let l=o.querySelector(".preview--document");l.innerHTML=n.title,l.classList.remove("preview--document"),l.classList.add("upload--document"),l.onclick=e=>a.uploadDocument({event:e}),o.querySelector(".delete__button").remove();try{let i=await e({ftchURI:"/wp-json/tinsinhphuc/document/remove",data:{method:"POST",body:JSON.stringify({owner:n})}});r.open({message:i.message,icon:!0,style:"info",timer:1500})}catch{}},a.previewDocument=({event:e})=>{e.preventDefault();let t=e.target.closest("a").owner;PDFObject.embed(`${n}${t.file}`,"#modalmaster .modal__body",{height:"830px",width:"830px"}),o.open({config:{clear:!0,title:`Bạn đang xem ${t.file}`,header:!0,footer:!1}})},a.uploadDocument=({event:e})=>{e.preventDefault();let t=e.target.closest("a"),r=o.modal.body.querySelector("#uploader"),n=o.modal.footer.querySelector(".upload__toserver");r||o.modal.body.append(a.form.drag.main),n?n.target=t:o.modal.footer.append(a.uploadButtonFiles({target:t})),o.open({config:{title:`Bạn ${t.owner.title} cho #${t.owner.ID}`,footer:!0}})},a.dragAndDropUploadForm=()=>{let e=new l().init({id:"uploader",config:{label:"Ấn hoặc k\xe9o thả file v\xe0o đ\xe2y",dataType:"file",multiple:!1,accept:"application/pdf"}});return e},a.uploadButtonFiles=({target:e})=>t({tag:"p",className:"upload__server",children:[{tag:"span",innerHTML:"Tải l\xean server",className:"upload__toserver button --primary",target:e,onclick:e=>a.uploadFileToServer({event:e})}]}),a.uploadFileToServer=async({event:t})=>{let n=a.form.drag.input.files[0],l=t.target.target,i=new FormData;if(i.append("files",n),n)try{let m=await e({ftchURI:"/wp-json/tinsinhphuc/document/upload",data:{method:"POST",body:i,headers:{}}});if(console.log(m),m.result){l.owner.file=n.name;let c=l.querySelector(".upload--document");c.innerHTML=n.name,c.classList.remove("upload--document"),c.classList.add("preview--document"),c.onclick=e=>a.previewDocument({event:e}),l.append(a.removeButton()),a.form.inputFile.value=null,a.form.uploadFileName.innerHTML="File name here",a.form.message.innerHTML="",o.close({clear:!1}),r.open({message:m.message,icon:!0,style:"info",timer:1500})}else a.form.message.innerHTML=m.message}catch{}else a.form.message.innerHTML="Chọn file đi \xd4ng thần ve chai!!!!"}},dDocument=new DDocument().init();